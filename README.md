- [**共享车位产品方案**](#------------)
  * [1. 用户](#1---)
    + [共有操作](#----)
      - [**注册/登录**](#---------)
      - [**查找车位**](#--------)
      - [**导航**](#------)
    + [车位相关操作](#------)
      - [**车位登记**](#--------)
      - [**车位删除**](#--------)
      - [**绑定车位锁**](#---------)
  * [2、管理员](#2----)
    + [**登录**](#------)
    + [**部署停车场**](#---------)
    + [**移除停车场**](#---------)
- [MySQL表的设计](#mysql----)
  * [`user` 用户表（注册/登录）](#-user------------)
  * [`park` 停车场表(管理员登记)](#-park-------------)
  * [`"parkid"` 停车场车位表 (车位主登记)](#--parkid-----------------)
  * [`lock`车位锁表 （车位锁出场设置）](#-lock---------------)

<small><i><a href='http://ecotrust-canada.github.io/markdown-toc/'>Table of contents generated with markdown-toc</a></i></small>





#  **共享车位产品方案**

*当前车位紧张，没处停没法停的问题比比皆是，所以共享车位app应运而生。*
***

## 1. 用户
### 共有操作
- #### **注册/登录**
   程序对`user`表进行操作
- #### **查找车位**
   *通过地图上的搜索框搜索目的地，地图将跳转至目的地位置，选择目的地所在位置周围的标记点，即可跳转至停车场页面，挑选停车场中的车位*

- #### **导航**
   *在停车场页面可选择启动导航功能*

### 车位相关操作
- #### **车位登记**

   *在购买车位锁(展示阶段通过手机模拟)并安装后，用户(车位主)可将自己的车位，在app中展示的停车场(app服务商需要与小区停车场合作，展示阶段可在数据库中任意创建一个用于展示)中登记，来进行车位出租，请明确车位空闲时间*

   
   1.用户在地图上选择车位所在停车场(获取`parkid`)后，选择已绑定的空闲的车位锁（获取锁`id`=`parkid`），并输入空闲时间段(获取'freetime')确认价格后进行登记
   ```sql
   insert into 'parkid' ('spaceid','freetime','pride') values (spaceid,freetime,pride);
   ```

   2.程序将修改车位锁内的程序，车位锁会存储时间数据，在空闲时间结束时连接至服务器将`state`的值置为0，空闲时间开始时置为1
   的属性
   


- #### **车位删除**

   *车位主可在车位非空闲时间内进行车位登记的注销*
   删除 `'parkid'`表中选定元素 
   

- #### **绑定车位锁**

   *要想进行车位登记，必须要登记车位锁，车位锁虚车位主自行购买，通过输入车位锁id进行绑定*

   update ``lock``表





## 2、管理员
- ### **登录**
   管理员账号为内部初始账号，无法注册
- ### **部署停车场**
   在与停车场达成合作后，通过管理页面在百度地图中标注位置*(获取`lng,lat`)，在输入停车场名称(获取`parkname`) 后完成创建
   ```sql
   insert into 'park' ('parkname','lng','lat') values (parkname,lng,lat);
   ```
- ### **移除停车场**
   在管理列表中，找到停车场并移除




***
# MySQL表的设计
***
## `user` 用户表（注册/登录）
| 元素     | 值         |描述                    |属性|
| ---------| ----------- |--------------------- |----|
| username | varchar(16) |用户名                |key|
| password | varchar(256)| md5(密码+salt)       |
| power    | int(1)      | 权限(普通用户/管理员) |
| salt     | char(50)    | 盐值                 |
| timestamp |timestamp   |注册时间              |



## `park` 停车场表(管理员登记)
| 元素     | 值         |描述                    |属性|
| ---------| ----------- |--------------------- |----|
|  parkid  | int          |  自增                | key |
| parkname | varchar(16) |停车场名               |  |
| lng      | varchar(18)| 经度                   |联合外键|
| lat      | varchar(18)| 维度                    |联合外键|
| num    | int       | 车位空余数目                |   |

*管理员每在`park`表插入/删除一条数据，程序会在返回正常的情况下，创建/删除与数据中`parkid`值同名的表*

*`num`* *值为* **`parkname`** *表中的`sum(state)`*



*从百度地图api返回格式可知记录经纬度的lng与lat格式，可知坐标范围为* `3位+.+14位` *所以使用varchar(18)存储*

**
```json
{
    "status":0,
    "result":{
        "location":{
            "lng":108.77640706504717,
            "lat":34.03649469331392
        },
        "precise":0,
        "confidence":50,
        "comprehension":100,
        "level":"NoClass"
    }
}
```

## `"parkid"` 停车场车位表 (车位主登记)
| 元素     | 值         |描述                    |属性|
| ---------| ----------- |--------------------- |----|
|  spaceid  | int          | 与`lock`表中 *`id`* 相同  | key |
| state | int(1)         |   车位是否空闲                   |  |
|  price |  flout     | 价格单位`元/时`                 |      | 
| freetime| varchar(11)  |  仅作为显示使用 格式:`xx:xx-xx:xx` |        |


*`freetime`值只作为显示使用，在客户端中部署车位锁后，车位锁会存储相同的时间数据，在空闲时间结束时间发送信息将`state`的值置为0，开始时置为1*

## `lock`车位锁表 （车位锁出场设置）
| 元素     | 值         |描述                    |属性|
| ---------| ----------- |--------------------- |----|
|   id  | int          | 车位锁的唯一`id`        | key |
|username|   varchar(16)     | 车位锁绑定账号id初始置`null`|    |
| state  |  int(1)              | 是否在使用中                ||

*车位锁在绑定成功后将向* ***Iot服务器发布*** *与`id`同名的`Topic`*
*客户端app将会在稍后订阅*